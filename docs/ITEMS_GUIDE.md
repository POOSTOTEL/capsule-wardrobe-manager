# Руководство по работе с вещами (Items)

## Обзор

Модуль управления вещами позволяет добавлять, редактировать, просматривать и удалять элементы гардероба с фотографиями, категориями, цветами, сезонами и тегами.

## Основные операции

### 1. Просмотр списка вещей

**URL:** `/items`

**Описание:** Отображает список всех вещей пользователя с возможностью фильтрации.

**Функции:**
- Просмотр всех вещей в виде сетки
- Фильтрация по категориям, цветам, сезонам, тегам
- Поиск по названию
- Сортировка по дате добавления, названию или использованию

**Как использовать:**
1. Перейдите на страницу "Вещи" в меню навигации
2. Используйте панель фильтров для поиска нужных вещей
3. Кликните на карточку вещи для просмотра деталей

### 2. Добавление новой вещи

**URL:** `/items/create`

**Описание:** Форма для добавления новой вещи в гардероб.

**Обязательные поля:**
- **Название** - название вещи (макс. 200 символов)
- **Категория** - выбор из списка категорий (верх, низ, обувь и т.д.)
- **Фотография** - изображение вещи (JPEG, PNG, GIF, WebP, макс. 5MB)

**Опциональные поля:**
- **Цвет** - выбор цвета из справочника
- **Сезон** - выбор сезона (лето, зима, демисезон, всесезон)
- **Теги** - выбор одного или нескольких тегов
- **Заметки** - дополнительная информация (макс. 1000 символов)

**Как использовать:**
1. Нажмите кнопку "Добавить вещь" на странице списка вещей
2. Заполните обязательные поля:
   - Введите название вещи
   - Выберите категорию из выпадающего списка
   - Загрузите фотографию (кликните на область загрузки или перетащите файл)
3. Заполните опциональные поля при необходимости
4. Выберите теги (можно создать новый тег прямо в форме)
5. Нажмите "Сохранить вещь"

**Важно:**
- Изображение автоматически сжимается, если его размер превышает 2MB
- Максимальный размер загружаемого файла: 5MB
- Поддерживаемые форматы: JPEG, PNG, GIF, WebP

### 3. Просмотр деталей вещи

**URL:** `/items/{id}`

**Описание:** Детальная страница вещи со всей информацией.

**Отображаемая информация:**
- Фотография вещи
- Название
- Категория
- Цвет (с визуальным индикатором)
- Сезон
- Теги (с цветовыми метками)
- Заметки
- Статистика использования
- Даты создания и обновления

**Действия:**
- Редактировать вещь
- Вернуться к списку вещей

### 4. Редактирование вещи

**URL:** `/items/{id}/edit`

**Описание:** Форма для редактирования существующей вещи.

**Как использовать:**
1. Откройте детальную страницу вещи
2. Нажмите кнопку "Редактировать"
3. Измените нужные поля
4. Для замены изображения кликните на текущее изображение
5. Нажмите "Сохранить изменения"

**Примечание:** Изображение можно заменить, но это необязательно - если новое изображение не загружено, старое останется.

### 5. Удаление вещи

**Описание:** Удаление вещи из гардероба.

**Как использовать:**
1. На странице списка вещей найдите нужную вещь
2. Нажмите кнопку с иконкой корзины на карточке вещи
3. Подтвердите удаление в диалоговом окне

**Важно:** 
- Удаление необратимо
- Вещь будет удалена из всех образов и капсул, где она использовалась

## Фильтрация и поиск

### Панель фильтров

На странице списка вещей доступны следующие фильтры:

1. **Поиск по названию**
   - Введите часть названия в поле поиска
   - Поиск выполняется автоматически при вводе (с задержкой 500мс)

2. **Фильтр по категории**
   - Выберите категорию из выпадающего списка
   - Показывает только вещи выбранной категории

3. **Фильтр по цвету**
   - Выберите цвет из списка
   - Показывает только вещи выбранного цвета

4. **Фильтр по сезону**
   - Выберите сезон из списка
   - Показывает только вещи для выбранного сезона

5. **Фильтр по тегам**
   - Выберите один или несколько тегов
   - Показывает вещи, которые имеют все выбранные теги

6. **Сортировка**
   - По дате добавления (новые сначала)
   - По названию (алфавитный порядок)
   - По использованию (чаще используемые сначала)

### Комбинирование фильтров

Все фильтры можно использовать одновременно. Например:
- Все красные вещи категории "Верх" для лета
- Все вещи с тегами "Офис" и "Деловой"

### Сброс фильтров

Нажмите кнопку "Сбросить" в панели фильтров, чтобы очистить все фильтры и показать все вещи.

## Работа с тегами

### Выбор тегов при создании/редактировании

1. В форме создания/редактирования вещи найдите раздел "Теги"
2. Начните вводить название тега в поле поиска
3. Выберите тег из списка предложенных
4. Можно выбрать несколько тегов
5. Можно создать новый тег, если его еще нет

### Популярные теги

Система показывает популярные теги (наиболее используемые) для быстрого выбора.

## API Endpoints

Для программного доступа доступны следующие API endpoints:

### Получить список вещей
```
GET /api/items?category_id=1&color_id=2&search=куртка
```

**Параметры запроса:**
- `category_id` - ID категории
- `color_id` - ID цвета
- `season_id` - ID сезона
- `search` - поисковый запрос
- `tag_ids` - список ID тегов через запятую
- `order_by` - поле сортировки (created_at, name, usage_count)
- `order_dir` - направление сортировки (ASC, DESC)
- `limit` - количество записей (по умолчанию 50)
- `offset` - смещение для пагинации

**Ответ:**
```json
{
  "success": true,
  "data": [...],
  "count": 10
}
```

### Получить вещь по ID
```
GET /api/items/{id}
```

**Ответ:**
```json
{
  "success": true,
  "data": {
    "id": 1,
    "name": "Синяя куртка",
    "category_name": "Верхняя одежда",
    ...
  }
}
```

### Получить изображение вещи
```
GET /api/items/{id}/image
```

**Ответ:** Бинарные данные изображения с соответствующим Content-Type

### Создать вещь
```
POST /items
Content-Type: multipart/form-data
```

**Поля формы:**
- `name` (обязательно)
- `category_id` (обязательно)
- `image` (обязательно, файл)
- `color_id` (опционально)
- `season_id` (опционально)
- `tags` (опционально, список ID через запятую)
- `notes` (опционально)

### Обновить вещь
```
POST /items/{id}
PUT /items/{id}
Content-Type: multipart/form-data
```

**Поля формы:** те же, что и при создании (все опциональны, кроме тех, что нужно изменить)

### Удалить вещь
```
DELETE /api/items/{id}
POST /items/{id}/delete
```

## Технические детали

### Хранение изображений

Изображения хранятся в базе данных PostgreSQL в поле типа BYTEA. Это позволяет:
- Гарантировать целостность данных
- Упростить резервное копирование
- Избежать проблем с файловой системой

### Автоматическое сжатие

Если размер изображения превышает 2MB, оно автоматически сжимается:
- Максимальный размер после сжатия: 1200x1200 пикселей
- Качество JPEG: 85%
- Качество PNG: 8 (из 9)

### Индекс использования

Система автоматически подсчитывает, сколько раз вещь использовалась в образах и капсулах. Этот индекс отображается на карточке вещи и в детальной информации.

## Часто задаваемые вопросы

**Q: Можно ли загрузить несколько изображений для одной вещи?**  
A: Нет, каждая вещь может иметь только одно изображение. При необходимости можно заменить его при редактировании.

**Q: Что делать, если изображение не загружается?**  
A: Проверьте:
- Формат файла (должен быть JPEG, PNG, GIF или WebP)
- Размер файла (не более 5MB)
- Наличие свободного места в базе данных

**Q: Как удалить вещь?**  
A: На странице списка вещей нажмите кнопку с иконкой корзины на карточке вещи и подтвердите удаление.

**Q: Можно ли восстановить удаленную вещь?**  
A: Нет, удаление необратимо. Рекомендуется делать резервные копии базы данных.

**Q: Как работает фильтрация по тегам?**  
A: При выборе нескольких тегов показываются только вещи, которые имеют ВСЕ выбранные теги (логическое И).

## Решение проблем

### Ошибка "Неподдерживаемый тип изображения"
- Убедитесь, что файл имеет расширение .jpg, .jpeg, .png, .gif или .webp
- Проверьте, что файл действительно является изображением

### Ошибка "Файл слишком большой"
- Уменьшите размер изображения перед загрузкой
- Используйте инструменты для сжатия изображений

### Ошибка "Database error: invalid byte sequence"
- Эта ошибка была исправлена в последней версии
- Убедитесь, что используете актуальную версию кода
- Если ошибка повторяется, проверьте настройки кодировки базы данных (должна быть UTF-8)

### Изображение не отображается
- Проверьте, что изображение было успешно загружено
- Проверьте права доступа к базе данных
- Очистите кеш браузера
