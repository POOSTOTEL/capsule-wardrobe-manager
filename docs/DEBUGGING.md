# Руководство по отладке

## Логирование

Система автоматически логирует все важные операции и ошибки в файл `logs/app.log`.

### Просмотр логов

**Windows:**
```powershell
# В PowerShell
Get-Content logs/app.log -Tail 50

# Или в командной строке
type logs\app.log
```

**Linux/Mac:**
```bash
tail -f logs/app.log
```

### Уровни логирования

- **DEBUG** - детальная информация для отладки (SQL запросы, параметры)
- **INFO** - информационные сообщения (успешные операции)
- **WARNING** - предупреждения
- **ERROR** - ошибки с детальной информацией

### Что логируется при создании вещи

1. **Начало создания** - входные данные (без бинарных данных изображения)
2. **Обработка изображения** - размер файла, MIME тип
3. **SQL запрос** - структура запроса, параметры
4. **Успешное создание** - ID созданной вещи
5. **Ошибки** - полная информация об ошибке, включая трейс

### Пример логов

```
[2024-01-15 10:30:45] [INFO] Начало создания вещи {"user_id":1,"data":{"name":"Куртка","category_id":1},"image_size":245678,"image_type":"image/jpeg"}
[2024-01-15 10:30:45] [DEBUG] createWithImage: чтение файла {"path":"/tmp/phpXXXXXX","size":245678}
[2024-01-15 10:30:45] [DEBUG] createWithImage: MIME тип определен {"mime_type":"image/jpeg"}
[2024-01-15 10:30:45] [DEBUG] Выполнение INSERT для items {"columns":["user_id","name","category_id","image_data","image_mime_type"],"has_image":true}
[2024-01-15 10:30:45] [INFO] Вещь создана успешно {"item_id":5}
```

## Отладка в браузере

### Консоль разработчика

1. Откройте консоль разработчика (F12)
2. Перейдите на вкладку "Console"
3. При создании вещи вы увидите:
   - Статус ответа сервера
   - Данные ответа
   - Детальную информацию об ошибках (если есть)

### Сетевые запросы

1. Откройте вкладку "Network" в консоли разработчика
2. Найдите запрос к `/items` (POST)
3. Проверьте:
   - **Request Payload** - что отправляется на сервер
   - **Response** - что возвращает сервер
   - **Status Code** - код ответа (200 = успех, 400/500 = ошибка)

## Типичные проблемы и решения

### Ошибка "Ошибка при создании вещи"

**Шаг 1:** Проверьте логи
```bash
tail -n 100 logs/app.log | grep ERROR
```

**Шаг 2:** Проверьте консоль браузера
- Откройте F12 → Console
- Найдите красные сообщения об ошибках

**Шаг 3:** Проверьте Network запрос
- F12 → Network
- Найдите POST запрос к `/items`
- Посмотрите Response - там будет детальная информация об ошибке

### Ошибка базы данных

Если в логах видна ошибка БД:
1. Проверьте подключение к БД
2. Проверьте структуру таблицы `items`
3. Убедитесь, что все необходимые поля существуют

### Проблемы с изображением

Если ошибка связана с изображением:
1. Проверьте размер файла (макс. 5MB)
2. Проверьте формат (JPEG, PNG, GIF, WebP)
3. Проверьте права доступа к временным файлам PHP

## Включение режима отладки

В файле `config/app.php` установите:
```php
'debug' => true,
```

В режиме отладки:
- Показываются детальные ошибки в ответах API
- Логируются все SQL запросы
- Выводится информация о файле и строке ошибки

## Очистка логов

Логи накапливаются со временем. Для очистки:

**Windows:**
```powershell
Clear-Content logs/app.log
```

**Linux/Mac:**
```bash
> logs/app.log
```

## Получение помощи

При возникновении проблемы:
1. Скопируйте последние 50 строк из `logs/app.log`
2. Скопируйте ошибку из консоли браузера (F12 → Console)
3. Скопируйте Response из Network (F12 → Network → POST /items → Response)
4. Предоставьте эту информацию для диагностики
